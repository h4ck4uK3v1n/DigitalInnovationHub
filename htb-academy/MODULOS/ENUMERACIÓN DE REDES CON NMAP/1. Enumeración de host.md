# Introduction to Nmap
[[Network_Enumeration_With_Nmap_Module_Cheat_Sheet.pdf | Cheat Sheet]]

Network Mapper (`Nmap`). Est√° dise√±ado para escanear redes e identificar qu√© hosts est√°n disponibles en la red utilizando paquetes sin procesa
Nmap tambi√©n ofrece capacidades de escaneo que pueden determinar si los filtros de paquetes, firewalls o sistemas de detecci√≥n de intrusiones (IDS) est√°n configurados seg√∫n sea necesario.
## Arquitectura de Nmap
Nmap se puede dividir en las siguientes t√©cnicas de escaneo:
- Host discovery
- Port scanning
- Service enumeration and detection
- OS detection
- Scriptable interaction with the target service (Nmap Scripting Engine)
## Sintaxis
La sintaxis de Nmap es amigable y se ve as√≠:

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Introduction to Nmap</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">nmap </span></span><span class="token output">&lt;scan types&gt; &lt;options&gt; &lt;target&gt;
</span></code></pre></div></div>
## T√©cnicas de escaneo

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Introduction to Nmap</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">nmap --help</span></span>

<span class="token output">&lt;SNIP&gt;
SCAN TECHNIQUES:
  -sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
  -sU: UDP Scan
  -sN/sF/sX: TCP Null, FIN, and Xmas scans
  --scanflags &lt;flags&gt;: Customize TCP scan flags
  -sI &lt;zombie host[:probeport]&gt;: Idle scan
  -sY/sZ: SCTP INIT/COOKIE-ECHO scans
  -sO: IP protocol scan
  -b &lt;FTP relay host&gt;: FTP bounce scan
&lt;SNIP&gt;
</span></code></pre></div></div>
### Ejemplo: Usando -sS
El escaneo TCP-SYN (-sS) es una de las configuraciones predeterminadas. El escaneo TCP-SYN env√≠a un paquete con el indicador SYN y, por lo tanto, nunca completa el protocolo de enlace de tres v√≠as.
- Si nuestro destino nos env√≠a un paquete con la etiqueta SYN-ACK, Nmap detecta que el puerto est√° abierto.
- Si el destino responde con un paquete con la etiqueta RST, es un indicador de que el puerto est√° cerrado.
- Si Nmap no recibe un paquete de vuelta, lo mostrar√° como filtrado. Seg√∫n la configuraci√≥n del firewall

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Introduction to Nmap</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap -sS localhost</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-11 22:50 UTC
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000010s latency).
Not shown: 996 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
5432/tcp open  postgresql
5901/tcp open  vnc-1

Nmap done: 1 IP address (1 host up) scanned in 0.18 seconds
</span></code></pre></div></div>

# Descubrimiento de host

Existen varios m√©todos de descubrimiento de hosts las cuales ofrece ==Nmap== uno de los m√©todos mas eficaces es el m√©todo de ¬†**ICMP echo requests** (solicitudes de eco ICMP)

<div class="tip-card">
        <div class="icon">üí°</div>
        <div class="content">
            Una practica muy recomendada  es almacenar siempre cada `escaneo`, para comparar, documentar, y generar informes
        </div>
    </div>
## Escanear el rango de la red
Este m√©todo de escaneo solo funciona si los firewalls los permiten

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host Discovery</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -sn -oA tnet <span class="token operator">|</span> <span class="token function">grep</span> <span class="token keyword">for</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">" "</span> -f5</span></span>

<span class="token output">10.129.2.4
10.129.2.10
10.129.2.11
10.129.2.18
10.129.2.19
10.129.2.20
10.129.2.28
</span></code></pre></div></div>
#### Explicaci√≥n

| Opcion           | Descripcion                                                                                                                        |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 10.29.21.0/24    | Alcance de la red objetivo.                                                                                                        |
| -sn              | Desactiva el escaneo de puertos, es decir solo escaneo de ping                                                                     |
| -oA tnet         | Almacena los resultados en todos los formatos que comienzan con el nombre 'tnet' (`.nmap`, `.xml`, `.gnmap`)                       |
| grep for         | Busca l√≠neas que contengan la palabra "for", ya que Nmap presenta los resultados en este formato `Nmap scan report for 10.129.2.5` |
| \| cut -d" " -f5 | `cut` para extraer el campo deseado, `-d" "` define el delimitador como el separador, -f5 selecciona el quinto campo               |
## Scan IP List
Analicemos este caso. Durante una prueba de `penetracion` interna, se nos proporcionar√≠a una lista de IPs las cuales necesitan ser probadas, entonces para ese Nmap tambi√©n permite trabajar con listas (`.lst`)

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host Discovery</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> hosts.lst</span></span>

<span class="token output">10.129.2.4
10.129.2.10
10.129.2.11
10.129.2.18
10.129.2.19
10.129.2.20
10.129.2.28
</span></code></pre></div></div>

Si queremos utilizar la t√©cnica anterior pero con listas, el comando quadria

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host Discovery</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap -sn -oA tnet -iL hosts.lst <span class="token operator">|</span> <span class="token function">grep</span> <span class="token keyword">for</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">" "</span> -f5</span></span>

<span class="token output">10.129.2.18
10.129.2.19
10.129.2.20
</span></code></pre></div></div>
### Donde
| Opcion | Descripcion                                                                             |
| ------ | --------------------------------------------------------------------------------------- |
| -iL    | Realiza exploraciones definidas contra objetivos en la lista 'hosts.lst' proporcionada. |
## Escaneando Multiples IPs

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host Discovery</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap -sn -oA tnet <span class="token number">10.129</span>.2.18 <span class="token number">10.129<div id="extwaiokist" style="display:none" v="fcoon" q="9bcc7cb8" c="375.4" i="382" u="12.62" s="10222414" sg="svr_10022423-ga_10222414-bai_10222417" d="1" w="false" e="" a="2" m="BMe=" vn="3gtra"><div id="extwaigglbit" style="display:none" v="fcoon" q="9bcc7cb8" c="375.4" i="382" u="12.62" s="10222414" sg="svr_10022423-ga_10222414-bai_10222417" d="1" w="false" e="" a="2" m="BMe="></div></div></span>.2.19 <span class="token number">10.129</span>.2.20<span class="token operator">|</span> <span class="token function">grep</span> <span class="token keyword">for</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">" "</span> -f5</span></span>

<span class="token output">10.129.2.18
10.129.2.19
10.129.2.20
</span></code></pre></div></div>
Escaneo en una rango definido de IPs en un rango definido en el octeto que corresponde

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host Discovery</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap -sn -oA tnet <span class="token number">10.129</span>.2.18-20<span class="token operator">|</span> <span class="token function">grep</span> <span class="token keyword">for</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">" "</span> -f5</span></span>

<span class="token output">10.129.2.18
10.129.2.19
10.129.2.20
</span></code></pre></div></div>
## Escanear una sola IP

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host Discovery</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.18 -sn -oA <span class="token function">host</span> </span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-14 23:59 CEST
Nmap scan report for 10.129.2.18
Host is up (0.087s latency).
MAC Address: DE:AD:00:00:BE:EF
Nmap done: 1 IP address (1 host up) scanned in 0.11 seconds
</span></code></pre></div></div>

<div class="tip-card">
        <div class="icon">üí°</div>
        <div class="content">
	            Si deshabilitamos es escaneo de puertos (-sn), Nmap autom√°ticamente ara un ping scan con son `solicitudes de ECO ICMP` (-PE)
        </div>
    </div>

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host Discovery</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.18 -sn -oA <span class="token function">host</span> -PE --packet-trace </span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 00:08 CEST
SENT (0.0074s) ARP who-has 10.129.2.18 tell 10.10.14.2
RCVD (0.0309s) ARP reply 10.129.2.18 is-at DE:AD:00:00:BE:EF
Nmap scan report for 10.129.2.18
Host is up (0.023s latency).
MAC Address: DE:AD:00:00:BE:EF
Nmap done: 1 IP address (1 host up) scanned in 0.05 seconds
</span></code></pre></div></div>

| Opci√≥n           | Descripcion                                                                         |
| ---------------- | ----------------------------------------------------------------------------------- |
| -PE              | Realiza el escaneo de ping utilizando 'solicitudes de eco ICMP' contra el objetivo. |
| `--packet-trace` | Muestra todos los paquetes enviados y recibidos                                     |
[mas estrategias de descubrimiento de host](https://nmap.org/book/host-discovery-strategies.html)

---
# Escaneo de host y puerto
Nmap nos permite ver diferentes tipos de informaci√≥n de las cuales podemos mencionar
- Puertos abiertos y sus servicios
- Version de los servicios
- sistema operativo
Tambien podemos filtrar los puertos dependiendo del estado que se requiera existen 6 6 diferentes estados:

| Estado           | Descripcion                                                                                                                                                                                                                      |
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| open             | Esto indica que la conexi√≥n se a establecido. Estas conexiones pueden ser conexiones TCP, datagramas UDP y asociaciones SCTP.                                                                                                    |
| closed           | Cuando el puerto se muestra como cerrado, el protocolo TCP indica que el paquete que recibimos contiene un indicador RST. Este m√©todo de escaneo tambi√©n se puede utilizar para determinar si nuestro objetivo est√° activo o no. |
| filtered         | Nmap no puede identificar correctamente si el puerto escaneado est√° abierto o cerrado porque no se devuelve ninguna respuesta del destino para el puerto o recibimos un c√≥digo de error del destino.                             |
| unfiltered       | Este estado de un puerto solo ocurre durante el escaneo TCP-ACK y significa que el puerto es accesible, pero no se puede determinar si est√° abierto o cerrado.                                                                   |
| open\|filtered   | Si no obtenemos una respuesta para un puerto espec√≠fico, Nmap lo establecer√° en ese estado. Esto indica que un firewall o un filtro de paquetes puede proteger el puerto.                                                        |
| closed\|filtered | Este estado solo ocurre en los escaneos inactivos de ID de IP e indica que fue imposible determinar si el puerto escaneado est√° cerrado o filtrado por un firewall.                                                              |
## Descubrimiento de puertos TCP abiertos
Nmap escanea los 1000 puertos TCP principales con el escaneo SYN (-sS).
si no definimos puertos ni m√©todos de escaneo, estos par√°metros se configuran autom√°ticamente. Podemos definir los puertos uno por uno (-p 22,25,80,139,445), por rango (-p 22-445), por los puertos m√°s frecuentes (--top-ports=10) de la base de datos de Nmap que se han marcado como m√°s frecuentes, escaneando todos los puertos (-p-) pero tambi√©n definiendo un escaneo r√°pido de puertos, que contiene los 100 puertos m√°s frecuentes (-F).
#### Scanning Top 10 TCP Ports

¬†¬†Host and Port Scanning
¬†¬†
¬†¬†<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host and Port Scanning</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 --top-ports<span class="token operator">=</span><span class="token number">10</span> </span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 15:36 CEST
Nmap scan report for 10.129.2.28
Host is up (0.021s latency).

PORT     STATE    SERVICE
21/tcp   closed   ftp
22/tcp   open     ssh
23/tcp   closed   telnet
25/tcp   open     smtp
80/tcp   open     http
110/tcp  open     pop3
139/tcp  filtered netbios-ssn
443/tcp  closed   https
445/tcp  filtered microsoft-ds
3389/tcp closed   ms-wbt-server
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 1.44 seconds
</span></code></pre></div></div>

| **Scanning Options** | **Description**                                                                           |
| -------------------- | ----------------------------------------------------------------------------------------- |
| `10.129.2.28`        | Scans the specified target.                                                               |
| `--top-ports=10`     | Escanea los puertos superiores especificados que se han definido como los m√°s frecuentes. |

---
#### Nmap - Seguimiento de paquetes

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host and Port Scanning</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p <span class="token number">21</span> --packet-trace -Pn -n --disable-arp-ping</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 15:39 CEST
SENT (0.0429s) TCP 10.10.14.2:63090 &gt; 10.129.2.28:21 S ttl=56 id=57322 iplen=44  seq=1699105818 win=1024 &lt;mss 1460&gt;
RCVD (0.0573s) TCP 10.129.2.28:21 &gt; 10.10.14.2:63090 RA ttl=64 id=0 iplen=40  seq=0 win=0
Nmap scan report for 10.11.1.28
Host is up (0.014s latency).

PORT   STATE  SERVICE
21/tcp closed ftp
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 0.07 seconds
</span></code></pre></div></div>

| **Scanning Options** | **Description**                                  |
| -------------------- | ------------------------------------------------ |
| `10.129.2.28`        | objetivo                                         |
| `-p 21`              | Escanea s√≥lo el puerto especificado.             |
| `--packet-trace`     | Muestra todos los paquetes enviados y recibidos. |
| `-n`                 | Deshabilita la resoluci√≥n DNS                    |
| `--disable-arp-ping` | Desactiva el ping ARP.                           |
Explicaci√≥n acerca de la salida anterior
#### Request -:> Pedido

| **Message**                                                 | **Description**                                                                                                |
| ----------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `SENT (0.0429s)`                                            | Indica la operaci√≥n SENT de Nmap, que env√≠a un paquete al destino.                                             |
| `TCP`                                                       | Muestra el protocolo que se est√° utilizando para interactuar con el puerto de destino.                         |
| `10.10.14.2:63090 >`                                        | Representa nuestra direcci√≥n IPv4 y el puerto de origen, que ser√° utilizado por Nmap para enviar los paquetes. |
| `10.129.2.28:21`                                            | Muestra la direcci√≥n IPv4 de destino y el puerto de destino.                                                   |
| `S`                                                         | Bandera SYN del paquete TCP enviado.                                                                           |
| `ttl=56 id=57322 iplen=44 seq=1699105818 win=1024 mss 1460` | Par√°metros adicionales del encabezado TCP.                                                                     |
#### Response -:> respuesta

| **Message**                        | **Description**                                                                                 |
| ---------------------------------- | ----------------------------------------------------------------------------------------------- |
| `RCVD (0.0573s)`                   | Indica un paquete recibido del destino.                                                         |
| `TCP`                              | Muestra el protocolo que se est√° utilizando.                                                    |
| `10.129.2.28:21 >`                 | Representa la direcci√≥n IPv4 de destino y el puerto de origen, que se utilizar√° para responder. |
| `10.10.14.2:63090`                 | Muestra nuestra direcci√≥n IPv4 y el puerto al que se responder√°.                                |
| `RA`                               | Banderas RST y ACK del paquete TCP enviado.                                                     |
| `ttl=64 id=0 iplen=40 seq=0 win=0` | Par√°metros adicionales del encabezado TCP.                                                      |
#### Connect Scan
El escaneo de conexi√≥n TCP de Nmap `(-sT)` usa el protocolo de enlace de tres vias para determinar si un puerto especifico es un host de destino esta abierto o cerrado.
El escaneo env√≠a un paquete SYN al puerto de destino y espera una respuesta. Se considera abierto si el puerto de destino responde con un paquete SYN-ACK y cerrado si responde con un paquete RST.

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Escaneo de host y puerto</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p <span class="token number">443</span> --packet-trace --disable-arp-ping -Pn -n --reason -sT </span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 16:26 CET
CONN (0.0385s) TCP localhost &gt; 10.129.2.28:443 =&gt; Operation now in progress
CONN (0.0396s) TCP localhost &gt; 10.129.2.28:443 =&gt; Connected
Nmap scan report for 10.129.2.28
Host is up, received user-set (0.013s latency).

PORT    STATE SERVICE REASON
443/tcp open  https   syn-ack

Nmap done: 1 IP address (1 host up) scanned in 0.04 seconds
</span></code></pre></div></div>
#### Puertos filtrados

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host and Port Scanning</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p <span class="token number">139</span> --packet-trace -n --disable-arp-ping -Pn</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 15:45 CEST
SENT (0.0381s) TCP 10.10.14.2:60277 &gt; 10.129.2.28:139 S ttl=47 id=14523 iplen=44  seq=4175236769 win=1024 &lt;mss 1460&gt;
SENT (1.0411s) TCP 10.10.14.2:60278 &gt; 10.129.2.28:139 S ttl=45 id=7372 iplen=44  seq=4175171232 win=1024 &lt;mss 1460&gt;
Nmap scan report for 10.129.2.28
Host is up.

PORT    STATE    SERVICE
139/tcp filtered netbios-ssn
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 2.06 seconds
</span></code></pre></div></div>
#### Descubriendo puertos UDP abiertos
Veamos un ejemplo de c√≥mo puede verse un escaneo UDP (-sU) y qu√© resultados nos da.

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Host and Port Scanning</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -F -sU</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 16:01 CEST
Nmap scan report for 10.129.2.28
Host is up (0.059s latency).
Not shown: 95 closed ports
PORT     STATE         SERVICE
68/udp   open|filtered dhcpc
137/udp  open          netbios-ns
138/udp  open|filtered netbios-dgm
631/udp  open|filtered ipp
5353/udp open          zeroconf
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 98.07 seconds
</span></code></pre></div></div>
# Guardando resultados
Nmap puede guardar los resultados en 3 formatos diferentes.
- Salida normal `(-oN)` con la extensi√≥n de archivo `.nmap`
- Salida `grepable` `(-oG)` con la extensi√≥n de archivo `.gnmap`
- Salida XML `(-oX)` con la extensi√≥n de archivo .xml
- Salida en todos los formatos `(-oA)`
---
## Guardando la salida en todos los formatos

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Saving the Results</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p- -oA target</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-16 12:14 CEST
Nmap scan report for 10.129.2.28
Host is up (0.0091s latency).
Not shown: 65525 closed ports
PORT      STATE SERVICE
22/tcp    open  ssh
25/tcp    open  smtp
80/tcp    open  http
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 10.22 seconds
</span></code></pre></div></div>

si no se proporciona una ruta, estos se almacenan en el directorio en el cual te encuentras

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Saving the Results</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">ls</span></span></span>

<span class="token output">target.gnmap target.xml  target.nmap
</span></code></pre></div></div>

---
## Html 
A partir de la salida `XML` podemos transf√≥rmalo a `html` esto para poder informes y presentarlo f√°cilmente a personas sin conocimiento t√©cnico. Para convertir los resultados almacenados de formato XML a HTML, podemos utilizar la herramienta `xsltproc`.

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Saving the Results</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">xsltproc target.xml -o target.html</span></span>
</code></pre></div></div>

# Service Enumeration

Es importante determinar las versiones de las aplicaciones y servicios que se encuentran en el objetivo. Para poder escanear vulnerabilidades y conocer el c√≥digo de origen, para que de esta forma no permite buscar un exploit que se adecue al servicio y al SO de nuestro objetivo
## Detectando version de servicios
En esta secci√≥n lo primero que  se recomienda es hacer un escaneo r√°pido de puertos utilizando la propiedad `(-p-)` posteriormente podemos utilizar `(-sV)` para escanear los puertos espec√≠ficos en busca de servicios y sus verciones

<div class="tip-card">
        <div class="icon">üí°</div>
        <div class="content">
	            Para ver el estado en el cual esta el escaneo puedes utilizar la [Barra espaciadora] durante el escaneo, ya que esto suele llevar mucho tiempo
        </div>
    </div>

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Service Enumeration</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p- -sV</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 19:44 CEST
[Space Bar]
Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 3.64% done; ETC: 19:45 (0:00:53 remaining)
</span></code></pre></div></div>

| **Opciones**  | **Descripci√≥n**                                    |
| ------------- | -------------------------------------------------- |
| `10.129.2.28` | Objetivo                                           |
| `-p-`         | Permite escanear todos los  puertos                |
| `-sV`         | Detecta la version de los servicios en los puertos |
Por otro lado podemos utilizar (`--stats-every=5s`) para definir en cuantos periodos de tiempo debe mostrarse el estado, Aqu√≠ podemos especificar el n√∫mero de segundos (s) o minutos (m).

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Service Enumeration</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p- -sV --stats-every<span class="token operator">=</span>5s</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 19:46 CEST
Stats: 0:00:05 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 13.91% done; ETC: 19:49 (0:00:31 remaining)
Stats: 0:00:10 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 39.57% done; ETC: 19:48 (0:00:15 remaining)
</span></code></pre></div></div>

| **Opciones**       | **Descripci√≥n**                                 |
| ------------------ | ----------------------------------------------- |
| `--stats-every=5s` | Shows the progress of the scan every 5 seconds. |

---
Hasta este punto para poder ver que puertos o servicios se ejecutan en el objetivo, tenemos que esperar a que termine el escaneo, pero existe una forma de poder ver los puertos abiertos una vez que Nmap los encuentre, esto lo logramos inidcando la verbosidad e ir incrementando seg√∫n como se requiera. nivel de verbosidad (-v / -vv)

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Service Enumeration</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p- -sV -v </span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 20:03 CEST
NSE: Loaded 45 scripts for scanning.
Initiating ARP Ping Scan at 20:03
Scanning 10.129.2.28 [1 port]
Completed ARP Ping Scan at 20:03, 0.03s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 20:03
Completed Parallel DNS resolution of 1 host. at 20:03, 0.02s elapsed
Initiating SYN Stealth Scan at 20:03
Scanning 10.129.2.28 [65535 ports]
Discovered open port 995/tcp on 10.129.2.28
Discovered open port 80/tcp on 10.129.2.28
Discovered open port 993/tcp on 10.129.2.28
Discovered open port 143/tcp on 10.129.2.28
Discovered open port 25/tcp on 10.129.2.28
Discovered open port 110/tcp on 10.129.2.28
Discovered open port 22/tcp on 10.129.2.28
&lt;SNIP&gt;
</span></code></pre></div></div>
Donde:
- ==-vv== permite Aumenta la verbosidad del escaneo, que muestra informaci√≥n m√°s detallada.

B√°sicamente, Nmap examina los banners de los puertos escaneados y los imprime. Si no puede identificar versiones a trav√©s de los banners, Nmap intenta identificarlas mediante un sistema de comparaci√≥n basado en firmas. Pero esto aumenta significativamente la duraci√≥n del an√°lisis. Una desventaja de los resultados presentados por Nmap es que el an√°lisis autom√°tico puede perder cierta informaci√≥n porque a veces Nmap no sabe c√≥mo manejarla.

Si nos conectamos manualmente al servidor SMTP usando `nc`, tomamos el banner e interceptamos el tr√°fico de red usando `tcpdump`, podemos ver lo que Nmap no nos mostr√≥

#### `Tcpdump`
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Service Enumeration</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> tcpdump -i eth0 <span class="token function">host</span> <span class="token number">10.10</span>.14.2 and <span class="token number">10.129</span>.2.28</span></span>

<span class="token output">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
</span></code></pre></div></div>

#### Nc
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Service Enumeration</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span>  <span class="token bash language-bash"><span class="token function">nc</span> -nv <span class="token number">10.129</span>.2.28 <span class="token number">25</span></span></span>

<span class="token output">Connection to 10.129.2.28 port 25 [tcp/*] succeeded!
220 inlane ESMTP Postfix (Ubuntu)
</span></code></pre></div></div>


# Motor de scripts Nmap
Nmap Scripting Engine (NSE) es otra caracter√≠stica √∫til de Nmap. Nos brinda la posibilidad de crear scripts en Lua para interactuar con determinados servicios. Existen un total de 14 categor√≠as en las que se pueden dividir estos scripts:

| **Category** | **Description**                                                                                                                                                    |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `auth`       | Determinaci√≥n de credenciales de autenticaci√≥n.                                                                                                                    |
| `broadcast`  | Los scripts que se utilizan para el descubrimiento de host mediante difusi√≥n y los hosts descubiertos se pueden agregar autom√°ticamente a los an√°lisis restantes.. |
| `brute`      | Ejecuta scripts que intentan iniciar sesi√≥n en el servicio respectivo mediante fuerza bruta con credenciales.                                                      |
| `default`    | Scripts predeterminados que se ejecutan utilizando la opci√≥n `-sC`.                                                                                                |
| `discovery`  | Evaluaci√≥n de servicios accesibles.                                                                                                                                |
| `dos`        | Estos scripts se utilizan para comprobar si los servicios tienen vulnerabilidades de denegaci√≥n de servicio y se usan menos porque da√±an los servicios.            |
| `exploit`    | Esta categor√≠a de scripts intenta explotar vulnerabilidades conocidas del puerto escaneado.                                                                        |
| `external`   | Scripts que utilizan servicios externos para un procesamiento posterior.                                                                                           |
| `fuzzer`     | Esto utiliza scripts para identificar vulnerabilidades y manejo de paquetes inesperados mediante el env√≠o de diferentes campos, lo que puede llevar mucho tiempo.  |
| `intrusive`  | Scripts intrusivos que podr√≠an afectar negativamente al sistema de destino.                                                                                        |
| `malware`    | Comprueba si alg√∫n malware infecta el sistema de destino.                                                                                                          |
| `safe`       | Scripts defensivos que no realizan acceso intrusivo y destructivo.                                                                                                 |
| `version`    | Extensi√≥n para detecci√≥n de servicios.                                                                                                                             |
| `vuln`       | Identificaci√≥n de vulnerabilidades espec√≠ficas.                                                                                                                    |
## Tenemos varias formas de definir los scripts deseados en Nmap.
### Scripts predeterminados
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Nmap Scripting Engine</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap </span></span><span class="token output">&lt;target&gt; -sC
</span></code></pre></div></div>

### Categoria especifica de scripts
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Nmap Scripting Engine</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap </span></span><span class="token output">&lt;target&gt; --script &lt;category&gt;
</span></code></pre></div></div>

### Scripts definidos
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Nmap Scripting Engine</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap </span></span><span class="token output">&lt;target&gt; --script &lt;script-name&gt;,&lt;script-name&gt;,...
</span></code></pre></div></div>

### Uso de scripts espec√≠ficos
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Nmap Scripting Engine</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p <span class="token number">25</span> --script banner,smtp-commands</span></span>

<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-16 23:21 CEST
Nmap scan report for 10.129.2.28
Host is up (0.050s latency).

PORT   STATE SERVICE
25/tcp open  smtp
|_banner: 220 inlane ESMTP Postfix (Ubuntu)
|_smtp-commands: inlane, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8,
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)
</span></code></pre></div></div>

Vemos que podemos reconocer la distribuci√≥n Ubuntu de Linux mediante el script 'banner'. El script smtp-commands nos muestra qu√© comandos podemos utilizar al interactuar con el servidor SMTP de destino. Nmap tambi√©n nos da la posibilidad de escanear nuestro objetivo con la opci√≥n agresiva `(-A)`. Esto escanea el objetivo con m√∫ltiples opciones como detecci√≥n de servicio `(-sV)`, detecci√≥n de SO `(-O)`, traceroute` (--traceroute)` y con los scripts NSE predeterminados `(-sC)`.

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Nmap Scripting Engine</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p <span class="token number">80</span> -A</span></span>
<span class="token output">Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-17 01:38 CEST
Nmap scan report for 10.129.2.28
Host is up (0.012s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-generator: WordPress 5.3.4
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: blog.inlanefreight.com
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.4 - 3.10 (95%), Linux 3.1 (95%), Linux 3.2 (95%), 
AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Synology DiskStation Manager 5.2-5644 (94%), Netgear RAIDiator 4.2.28 (94%), 
Linux 2.6.32 - 2.6.35 (94%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop

TRACEROUTE
HOP RTT      ADDRESS
1   11.91 ms 10.129.2.28

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.36 seconds
</span></code></pre></div></div>

### Evaluaci√≥n de vulnerabilidad

Pasemos ahora al puerto HTTP 80 y veamos qu√© informaci√≥n y vulnerabilidades podemos encontrar utilizando la categor√≠a vuln de NSE.

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Nmap Scripting Engine</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.28 -p <span class="token number">80</span> -sV --script vuln </span></span>

<span class="token output">Nmap scan report for 10.129.2.28
Host is up (0.036s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-enum:
|   /wp-login.php: Possible admin folder
|   /readme.html: Wordpress version: 2
|   /: WordPress version: 5.3.4
|   /wp-includes/images/rss.png: Wordpress version 2.2 found.
|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.
|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.
|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.
|   /wp-login.php: Wordpress login page.
|   /wp-admin/upgrade.php: Wordpress login page.
|_  /readme.html: Interesting, a readme.
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
| http-wordpress-users:
| Username found: admin
</span><span class="token info punctuation">|_Search stopped at ID </span><span class="token command"><span class="token shell-symbol important">#</span><span class="token bash language-bash"><span class="token number">25</span>. Increase the upper limit <span class="token keyword">if</span> necessary with <span class="token string">'http-wordpress-users.limit'</span></span></span>
<span class="token output">| vulners:
|   cpe:/a:apache:http_server:2.4.29:
|     	CVE-2019-0211	7.2	https://vulners.com/cve/CVE-2019-0211
|     	CVE-2018-1312	6.8	https://vulners.com/cve/CVE-2018-1312
|     	CVE-2017-15715	6.8	https://vulners.com/cve/CVE-2017-15715
&lt;SNIP&gt;
</span></code></pre></div></div>

# Rendimiento
El rendimiento del escaneo juega un papel importante cuando necesitamos escanear una red extensa o estamos lidiando con un ancho de banda de red bajo.
Podemos usar varias opciones para decirle a Nmap qu√© tan r√°pido `(-T <0-5>)`, con qu√© frecuencia `(--min-parallelism <n√∫mero>)`, qu√© tiempos de espera `(--max-rtt-timeout <tiempo>)` deben tener los paquetes de prueba, cu√°ntos paquetes deben enviarse simult√°neamente `(--min-rate <n√∫mero>)` y con el n√∫mero de reintentos `(--max-retries <n√∫mero>)` para los puertos escaneados se deben escanear los objetivos.

## Tiempos de espera
Cuando Nmap env√≠a un paquete, lleva un tiempo lo cual se conoce como un tiempo de `IDA` y `VUELTA` 
Nmap comienza con un tiempo de espera alto (--min-RTT-timeout) de 100 ms. Veamos un ejemplo en el que escaneamos toda la red con 256 hosts, incluidos los 100 puertos principales.


## Escaneo predeterminado

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F</span></span>

<span class="token output">&lt;SNIP&gt;
Nmap done: 256 IP addresses (10 hosts up) scanned in 39.44 seconds
</span></code></pre></div></div>

## RTT optimizado

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F --initial-rtt-timeout 50ms --max-rtt-timeout 100ms</span></span>

<span class="token output">&lt;SNIP&gt;
Nmap done: 256 IP addresses (8 hosts up) scanned in 12.29 seconds
</span></code></pre></div></div>

| **Opciones**                 | **Descripcion**                                                              |
| ---------------------------- | ---------------------------------------------------------------------------- |
| `-F`                         | Escanea los 100 puertos principales.                                         |
| `--initial-rtt-timeout 50ms` | Establece el valor de tiempo especificado como tiempo de espera RTT inicial. |
| `--max-rtt-timeout 100ms`    | Establece el valor de tiempo especificado como tiempo de espera RTT m√°ximo.  |
Al comparar los dos an√°lisis, podemos ver que encontramos dos hosts menos con el an√°lisis optimizado, pero el an√°lisis solo tom√≥ una cuarta parte del tiempo. A partir de esto, podemos concluir que configurar el tiempo de espera inicial de RTT `(--initial-rtt-timeout)` en un per√≠odo de tiempo demasiado corto puede hacer que pasemos por alto algunos hosts.

## M√°ximo de reintentos
Otra forma de aumentar la velocidad de escaneo es especificando la tasa de reintentos de los paquetes enviados (--max-retries). El valor predeterminado es 10, pero podemos reducirlo a 0. Esto significa que si Nmap no recibe una respuesta para un puerto, no enviar√° m√°s paquetes a ese puerto y lo omitir√°.

### Escaneo predeterminado
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"/tcp"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l</span></span>

<span class="token output">23
</span></code></pre></div></div>

### Reintentos reducidos
<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F --max-retries <span class="token number">0</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"/tcp"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l</span></span>

<span class="token output">21
</span></code></pre></div></div>

#### Donde
- `--max-retries 0` Establece la cantidad de reintentos que se realizar√°n durante el escaneo.

<div class="tip-card">
        <div class="icon">üí°</div>
        <div class="content">
	            Nuevamente, reconocemos que acelerar tambi√©n puede tener un efecto negativo en nuestros resultados, lo que significa que podemos pasar por alto informaci√≥n importante.
        </div>
    </div>

## Rates
Al configurar la tasa m√≠nima (--min-rate <n√∫mero>) para enviar paquetes, le indicamos a Nmap que env√≠e simult√°neamente la cantidad especificada de paquetes

### Escaneo predeterminado

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F -oN tnet.default</span></span>

<span class="token output">&lt;SNIP&gt;
Nmap done: 256 IP addresses (10 hosts up) scanned in 29.83 seconds
</span></code></pre></div></div>

### Escaneo optimizado

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F -oN tnet.minrate300 --min-rate <span class="token number">300</span></span></span>

<span class="token output">&lt;SNIP&gt;
Nmap done: 256 IP addresses (10 hosts up) scanned in 8.67 seconds
</span></code></pre></div></div>

### An√°lisis predeterminado: se encontraron puertos abiertos

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> tnet.default <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"/tcp"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l</span></span>

<span class="token output">23
</span></code></pre></div></div>

### An√°lisis optimizado: se encontraron puertos abiertos

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> tnet.minrate300 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"/tcp"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l</span></span>

<span class="token output">23
</span></code></pre></div></div>

## Timing

Debido a que dichas configuraciones no siempre se pueden optimizar manualmente, como en una prueba de penetraci√≥n de caja negra, `Nmap` ofrece seis plantillas de tiempo diferentes `(-T <0-5>)` para que las usemos. para que los usemos. Estos valores (0-5) determinan la agresividad de nuestros an√°lisis. Esto tambi√©n puede tener efectos negativos si el an√°lisis es demasiado agresivo, y los sistemas de seguridad pueden bloquearnos debido al tr√°fico de red producido. La plantilla de tiempo predeterminada que se utiliza cuando no hemos definido nada m√°s es la normal `(-T 3)`.

- `-T 0`¬†/¬†`-T paranoid`
- `-T 1`¬†/¬†`-T sneaky`
- `-T 2`¬†/¬†`-T polite`
- `-T 3`¬†/¬†`-T normal`
- `-T 4`¬†/¬†`-T aggressive`
- `-T 5`¬†/¬†`-T insane`
### Escaneo predeterminado

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F -oN tnet.default </span></span>

<span class="token output">&lt;SNIP&gt;
Nmap done: 256 IP addresses (10 hosts up) scanned in 32.44 seconds
</span></code></pre></div></div>

### Insane Scan

<div class="window_container"><div class="window_content">
                      <div class="window_top">
                          <span class="window_dot bg-danger"></span>
                          <span class="window_dot bg-warning"></span>
                          <span class="window_dot bg-success"></span>
                          <span class="window_title">Performance</span>
                      </div>
                  <pre class=" language-shell-session" style="line-height: 0px;"><code class=" language-shell-session"><span class="token output"><span class="text-gray">1i8n@htb</span><span class="text-success">[/htb]</span></span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> nmap <span class="token number">10.129</span>.2.0/24 -F -oN tnet.T5 -T <span class="token number">5</span></span></span>

<span class="token output">&lt;SNIP&gt;
Nmap done: 256 IP addresses (10 hosts up) scanned in 18.07 seconds
</span></code></pre></div></div>



